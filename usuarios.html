<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Link CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./static/css/style.css" />

    <!-- favicon -->
    <link rel="icon" href="./static/img/favicon.ico" />

    <!-- Uso de FontAwesome -->
    <script
      src="https://kit.fontawesome.com/a8f340d9d3.js"
      crossorigin="anonymous"
    ></script>

    <!-- Uso de Material Icons -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <!-- Uso de RemixIcon -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <!-- Uso de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&display=swap"
      rel="stylesheet"
    />

    <title>Tu canchita</title>
  </head>

  <body class="inconsolata">
    <header>
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <div class="logo">
            <a href="/proyectoCancha/index.html">
              <img src="./static/img/logo.png" alt="" width="120" />
            </a>
          </div>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div
            class="collapse navbar-collapse justify-content-end"
            id="navbarNav"
          >
            <ul class="navbar-nav">
              <li><a id="login" href="./admin.html">Volver</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div class="banner">
        <h1>TU CANCHITA</h1>
        <h2>Complejo deportivo</h2>
      </div>

      <section id="usuariuos" class="complejo-container-admin">
        <h3 class="complejo_h3">Usuarios Registrados</h3>

        <div class="table-responsive">
          <table class="table table-success table-striped" id="tablaUsuarios">
            <thead>
              <tr>
                <th scope="col">#ID</th>
                <th scope="col">Nombre</th>
                <th scope="col">Apellido</th>
                <th scope="col">DNI</th>
                <th scope="col">Acciones</th>
              </tr>
            </thead>
            <tbody class="table-group-divider" id="cuerpoTablaUsuarios">
              <a href="" onclick=""></a>
              <!-- Las filas se agregarán aquí dinámicamente -->
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    const URL = "http://127.0.0.1:5000/";

    // Al subir al servidor, deberá utilizarse la siguiente ruta. USUARIO debe ser reemplazado por el nombre de usuario de Pythonanywhere
    //const URL = "https://USUARIO.pythonanywhere.com/"

    fetch(URL + "usuarios")
      .then((response) => {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error(
            `HTTP Error: ${response.status} - No se pudo obtener los usuarios.`
          );
        }
      })
      .then((data) => {
        let cuerpoTablaUsuarios = document.getElementById(
          "cuerpoTablaUsuarios"
        ); // Cuerpo de la tabla donde se agregarán las filas
        cuerpoTablaUsuarios.innerHTML = "";

        data.forEach((usuario) => {
          let fila = document.createElement("tr");
          fila.innerHTML = `<td>${usuario.id_usuario}</td>
                                      <td>${usuario.nombre}</td>
                                      <td>${usuario.apellido}</td>
                                      <td>${usuario.dni}</td>
                                      <td>
                                          <button class="btn btn-warning btn-action" onclick="">Editar</button>
                                          <button class="btn btn-danger btn-action" onclick="eliminarUsuario(${usuario.id_usuario})">Eliminar</button>
                                      </td>`;
          fila.style.cursor = "pointer";
          fila.onclick = () => verUsuario(usuario.id_usuario);
          cuerpoTablaUsuarios.appendChild(fila);
        });
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Error al obtener los usuarios.");
      });

    fetch(URL + "usuarios")
      .then((response) => {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error(
            `HTTP Error: ${response.status} - No se pudo obtener los usuarios.`
          );
        }
      })
      .then((data) => {
        let cuerpoTablaUsuarios = document.getElementById(
          "cuerpoTablaUsuarios"
        ); // Cuerpo de la tabla donde se agregarán las filas
        cuerpoTablaUsuarios.innerHTML = "";

        data.forEach((usuario) => {
          let fila = document.createElement("tr");
          fila.innerHTML = `<td>${usuario.id_usuario}</td>
                                      <td>${usuario.nombre}</td>
                                      <td>${usuario.apellido}</td>
                                      <td>${usuario.dni}</td>
                                      <td>
                                          <button class="btn btn-warning btn-action" onclick="">Editar</button>
                                          <button class="btn btn-danger btn-action" onclick="eliminarUsuario(${usuario.id_usuario})">Eliminar</button>
                                      </td>`;
          fila.style.cursor = "pointer";
          fila.onclick = () => verUsuario(usuario.id_usuario);
          cuerpoTablaUsuarios.appendChild(fila);
        });
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Error al obtener los usuarios.");
      });

    function eliminarUsuario(id_usuario) {
      if (confirm("¿Estás seguro de que deseas eliminar este usuario?"))
        fetch(URL + "usuarios/" + id_usuario, { method: "DELETE" }).then(
          (response) => {
            if (response.ok) {
              alert("Usuario eliminado exitosamente.");
              // Volver a cargar los datos para reflejar los cambios
              return fetch(URL + "usuarios");
            } else {
              throw new Error("Error al eliminar el usuario.");
            }
          }
        );
    }

    function verUsuario(id_usuario) {
      window.location.href = `vista_usuario.html?id=${id_usuario}`;
    }
  </script>
</html>
